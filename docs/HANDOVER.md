# 薬剤発注ナビ 引継ぎ資料

**作成日**: 2026-01-02  
**現行バージョン**: v23.0  
**開発中バージョン**: v24.0

---

## 1. プロジェクト概要

### 1.1 目的
医療機関における薬剤発注管理を効率化し、発注漏れを防止するWebアプリケーション。

### 1.2 技術スタック
- **バックエンド**: Google Apps Script (GAS)
- **フロントエンド**: HTML / CSS / JavaScript
- **データストア**: Google スプレッドシート
- **通知**: Google Chat Webhook
- **スケジュール**: Googleカレンダー

---

## 2. 開発環境のセットアップ

### 2.1 必要なアクセス権限
1. **Google Apps Script プロジェクト**: 編集権限
2. **スプレッドシート** (3つ):
   - スタッフマスター
   - 患者マスター
   - データDB
3. **Googleカレンダー**: 編集権限
4. **Google Chat Space**: Webhook設定権限

### 2.2 ローカル開発手順

1. **ソースコードの取得**
   ```
   Googleドライブ > マイドライブ > Antigravity-PJ > 薬剤発注ナビ
   ```

2. **GAS プロジェクトを開く**
   - [GASプロジェクトURL] にアクセス
   - または: スプレッドシート > 拡張機能 > Apps Script

3. **ファイル構成の確認**
   - 現行: `code.gs` + `index.html`
   - v24.0: 7ファイル構成 (詳細は実装計画参照)

---

## 3. フォルダ構成

```
薬剤発注ナビ/
├── SRC/                    # 現行本番ソース (GASに貼り付け用)
│   ├── code.gs
│   └── index.html
│
├── versions/               # バージョン履歴 (過去バージョン保存)
│   ├── v23.0/
│   │   ├── code.gs
│   │   ├── index.html
│   │   └── CHANGELOG.md
│   └── v24.0/              # 開発中
│       └── ...
│
└── docs/                   # ドキュメント
    ├── specification_vXX.md    # 詳細仕様書
    ├── VERSION_CONTROL.md      # バージョン管理ルール
    └── HANDOVER.md             # 本資料
```

---

## 4. 現在の開発状況

### 4.1 v23.0 (現行本番)
- **ステータス**: 本番稼働中
- **バックアップ**: `versions/v23.0/` に保存済み

### 4.2 v24.0 (開発完了)
- **ステータス**: 開発完了・テスト待ち
- **ファイル**: `versions/v24.0/` に全10ファイル作成済み
- **主な変更内容**:
  - ファイル分割 (10ファイル構成)
  - エラーハンドリング強化
  - 入力バリデーション
  - 担当者変更機能
  - キャッシュ機能 (10分TTL)
  - フィルター・検索機能
  - 操作ログ機能
  - 一括操作 (ステータス変更・削除)
  - 統計ダッシュボード (年度別・月別)

---

## 5. 作業再開手順

### 5.1 AI (Antigravity) との作業再開

1. **Gemini/Claude などの AI ツールを開く**

2. **以下のプロンプトを入力**:
   ```
   Q:\マイドライブ\Antigravity-PJ\薬剤発注ナビ のプロジェクトで作業を再開します。
   
   以下のドキュメントを確認してください:
   - docs/specification_v23.md (現行仕様)
   - docs/VERSION_CONTROL.md (バージョン管理ルール)
   - docs/HANDOVER.md (本資料)
   
   現在 v24.0 の開発中です。実装計画に従って作業を進めてください。
   ```

3. **AI が確認するファイル**:
   - `docs/` 内のドキュメント
   - `SRC/` または `versions/v24.0/` 内のソースコード

### 5.2 手動での作業再開

1. `docs/specification_v24.md` で仕様を確認
2. `versions/v24.0/` で最新ソースを確認
3. 変更を加えたら CHANGELOG.md を更新
4. テスト後、`SRC/` にコピーして GAS に反映

---

## 6. デプロイ手順

### 6.1 テストデプロイ
1. GAS エディタで「デプロイ」→「デプロイをテスト」
2. URL にアクセスして動作確認

### 6.2 本番デプロイ
1. GAS エディタで「デプロイ」→「新しいデプロイ」
2. 種類: ウェブアプリ
3. 実行: 自分
4. アクセス: nhw.jp 内のユーザー
5. デプロイIDを `CHANGELOG.md` に記録

### 6.3 ロールバック
1. 「デプロイを管理」から過去のデプロイを選択
2. 「アーカイブ解除」で有効化

---

## 7. 重要な連絡先・リンク

| 項目 | 内容 |
|------|------|
| GAS プロジェクト | [URLを記入] |
| データDB | [URLを記入] |
| スタッフマスター | [URLを記入] |
| 患者マスター | [URLを記入] |
| Google Chat Space | [URLを記入] |
| カレンダー | [URLを記入] |

---

## 8. トラブルシューティング

### 8.1 「権限エラー」が出る
- `nhw.jp` ドメイン以外のアカウントでアクセスしていないか確認
- GAS の実行ユーザー設定を確認

### 8.2 通知が届かない
- Webhook URL が正しいか確認
- Google Chat Space の設定を確認

### 8.3 データが表示されない
- スプレッドシートへのアクセス権限を確認
- シート名が「シート1」になっているか確認

---

## 9. 次のアクション

1. **ログシートの作成** (ユーザー作業)
   - データDBスプレッドシート内に「操作ログ」シートを作成
   - カラム: 日時 / 操作 / 対象ID / 詳細 / 実行者

2. **v24.0 実装開始** (AI作業)
   - フェーズ1: ファイル分割
   - フェーズ2: 品質向上
   - フェーズ3: 機能追加
   - フェーズ4: 運用効率化
